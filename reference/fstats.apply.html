<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate F-statistics per base by extracting chunks from a DataFrame — fstats.apply • derfinderHelper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate F-statistics per base by extracting chunks from a DataFrame — fstats.apply" />
<meta property="og:description" content="Extract chunks from a DataFrame and get the F-statistics on the rows of
data, comparing the models mod (alternative) and mod0
(null)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">derfinderHelper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.27.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/derfinderHelper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leekgroup/derfinderHelper/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate F-statistics per base by extracting chunks from a DataFrame</h1>
    <small class="dont-index">Source: <a href='https://github.com/leekgroup/derfinderHelper/blob/master/R/fstats.apply.R'><code>R/fstats.apply.R</code></a></small>
    <div class="hidden name"><code>fstats.apply.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extract chunks from a DataFrame and get the F-statistics on the rows of
<code>data</code>, comparing the models <code>mod</code> (alternative) and <code>mod0</code>
(null).</p>
    </div>

    <pre class="usage"><span class='fu'>fstats.apply</span><span class='op'>(</span>
  index <span class='op'>=</span> <span class='fu'>Rle</span><span class='op'>(</span><span class='cn'>TRUE</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='va'>data</span>,
  <span class='va'>mod</span>,
  <span class='va'>mod0</span>,
  adjustF <span class='op'>=</span> <span class='fl'>0</span>,
  lowMemDir <span class='op'>=</span> <span class='cn'>NULL</span>,
  method <span class='op'>=</span> <span class='st'>"Matrix"</span>,
  scalefac <span class='op'>=</span> <span class='fl'>32</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>index</th>
      <td><p>An index (logical Rle is the best for saving memory) indicating
which rows of the DataFrame to use.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>The DataFrame containing the coverage information. Normally
stored in <code>coveragePrep$coverageProcessed</code> from
<code>derfinder::preprocessCoverage</code>. Could also be the full data from
<code>derfinder::loadCoverage</code>.</p></td>
    </tr>
    <tr>
      <th>mod</th>
      <td><p>The design matrix for the alternative model. Should be m by p
where p is the number of covariates (normally also including the intercept).</p></td>
    </tr>
    <tr>
      <th>mod0</th>
      <td><p>The design matrix for the null model. Should be m by p_0.</p></td>
    </tr>
    <tr>
      <th>adjustF</th>
      <td><p>A single value to adjust that is added in the denominator of
the F-stat calculation. Useful when the Residual Sum of Squares of the
alternative model is very small.</p></td>
    </tr>
    <tr>
      <th>lowMemDir</th>
      <td><p>The directory where the processed chunks are saved when
using <code>derfinder::preprocessCoverage</code> with a specified <code>lowMemDir</code>.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Has to be either 'Matrix' (default), 'Rle' or 'regular'. See
details.</p></td>
    </tr>
    <tr>
      <th>scalefac</th>
      <td><p>The scaling factor used in
<code>derfinder::preprocessCoverage</code>. It is only used when
<code>method='Matrix'</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A numeric Rle with the F-statistics per base for the chunk in
question.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If <code>lowMemDir</code> is specified then <code>index</code> is expected to
specify the chunk number.</p>
<p>fstats.apply has three different implemenations which are controlled
by the <code>method</code> parameter. <code>method='regular'</code> coerces the data to
a standard 'matrix' object. <code>method='Matrix'</code> coerces the data to a
<a href='https://rdrr.io/pkg/Matrix/man/sparseMatrix.html'>sparseMatrix</a> which reduces the required memory. This method
is only usable when the projection matrices have row sums equal to 0. Note
that these row sums are not exactly 0 due to how the computer works, thus
leading to very small numerical differences in the F-statistics calculated
versus <code>method='regular'</code>. Finally, <code>method='Rle'</code> calculates the
F-statistics using the Rle compressed data without coercing it to other
types of objects, thus using less memory that the other methods. However,
it's speed is affected by the number of samples (n) as the current
implementation requires n (n + 1) operations, so it's only recommended for
small data sets. <code>method='Rle'</code> does result in small numerical
differences versus <code>method='regular'</code>.</p>
<p>Overall <code>method='Matrix'</code> is faster than the other options and requires
less memory than <code>method='regular'</code>. With tiny example data sets,
<code>method='Matrix'</code> can be slower than <code>method='regular'</code> because the
coercion step is slower.</p>
<p>In derfinder versions &lt;= 0.0.62, <code>method='regular'</code> was the only option
available.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Leonardo Collado-Torres, Jeff Leek</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Create some toy data</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://bioconductor.org/packages/IRanges'>"IRanges"</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required package: BiocGenerics</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: parallel</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘BiocGenerics’</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:parallel’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,</span>
#&gt; <span class='message'>    clusterExport, clusterMap, parApply, parCapply, parLapply,</span>
#&gt; <span class='message'>    parLapplyLB, parRapply, parSapply, parSapplyLB</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    IQR, mad, sd, var, xtabs</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    anyDuplicated, append, as.data.frame, basename, cbind, colnames,</span>
#&gt; <span class='message'>    dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,</span>
#&gt; <span class='message'>    grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,</span>
#&gt; <span class='message'>    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,</span>
#&gt; <span class='message'>    rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,</span>
#&gt; <span class='message'>    union, unique, unsplit, which.max, which.min</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: S4Vectors</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: stats4</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘S4Vectors’</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    expand.grid</span></div><div class='input'><span class='va'>toyData</span> <span class='op'>&lt;-</span> <span class='fu'>DataFrame</span><span class='op'>(</span>
    <span class='st'>"sample1"</span> <span class='op'>=</span> <span class='fu'>Rle</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>10</span>, <span class='fl'>1000</span>, <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='st'>"sample2"</span> <span class='op'>=</span> <span class='fu'>Rle</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>10</span>, <span class='fl'>1000</span>, <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='st'>"sample3"</span> <span class='op'>=</span> <span class='fu'>Rle</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>10</span>, <span class='fl'>1000</span>, <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='st'>"sample4"</span> <span class='op'>=</span> <span class='fu'>Rle</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>10</span>, <span class='fl'>1000</span>, <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'>## Create the model matrices</span>
<span class='va'>group</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"A"</span>, <span class='st'>"A"</span>, <span class='st'>"B"</span>, <span class='st'>"B"</span><span class='op'>)</span>
<span class='va'>mod.toy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/model.matrix.html'>model.matrix</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>group</span><span class='op'>)</span>
<span class='va'>mod0.toy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/model.matrix.html'>model.matrix</a></span><span class='op'>(</span><span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Get the F-statistics</span>
<span class='va'>fstats</span> <span class='op'>&lt;-</span> <span class='fu'>fstats.apply</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>toyData</span>, mod <span class='op'>=</span> <span class='va'>mod.toy</span>, mod0 <span class='op'>=</span> <span class='va'>mod0.toy</span>,
    scalefac <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span>


<span class='co'>## Example with data from derfinder package</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'>## Load the data</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'>"derfinder"</span><span class='op'>)</span>

<span class='co'>## Create the model matrices</span>
<span class='va'>mod</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/model.matrix.html'>model.matrix</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>genomeInfo</span><span class='op'>$</span><span class='va'>pop</span><span class='op'>)</span>
<span class='va'>mod0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/model.matrix.html'>model.matrix</a></span><span class='op'>(</span><span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>genomeInfo</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Run the function</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span><span class='op'>(</span><span class='va'>fstats.Matrix</span> <span class='op'>&lt;-</span> <span class='fu'>fstats.apply</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>genomeData</span><span class='op'>$</span><span class='va'>coverage</span>, mod <span class='op'>=</span> <span class='va'>mod</span>,
    mod0 <span class='op'>=</span> <span class='va'>mod0</span>, method <span class='op'>=</span> <span class='st'>"Matrix"</span>, scalefac <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span><span class='op'>)</span>
<span class='va'>fstats.Matrix</span>

<span class='co'>## Compare methods</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span><span class='op'>(</span><span class='va'>fstats.regular</span> <span class='op'>&lt;-</span> <span class='fu'>fstats.apply</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>genomeData</span><span class='op'>$</span><span class='va'>coverage</span>,
    mod <span class='op'>=</span> <span class='va'>mod</span>, mod0 <span class='op'>=</span> <span class='va'>mod0</span>, method <span class='op'>=</span> <span class='st'>"regular"</span>
<span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span><span class='op'>(</span><span class='va'>fstats.Rle</span> <span class='op'>&lt;-</span> <span class='fu'>fstats.apply</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>genomeData</span><span class='op'>$</span><span class='va'>coverage</span>, mod <span class='op'>=</span> <span class='va'>mod</span>,
    mod0 <span class='op'>=</span> <span class='va'>mod0</span>, method <span class='op'>=</span> <span class='st'>"Rle"</span>
<span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Small numerical differences can occur</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fstats.regular</span> <span class='op'>-</span> <span class='va'>fstats.Matrix</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fstats.regular</span> <span class='op'>-</span> <span class='va'>fstats.Rle</span><span class='op'>)</span>

<span class='co'>## You can make the effect negligible by appropriately rounding</span>
<span class='co'>## findRegions(cutoff) so the DERs will be the same regardless of the method</span>
<span class='co'>## used.</span>

<span class='co'>## Extra comparison, although the method to compare against is 'regular'</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fstats.Rle</span> <span class='op'>-</span> <span class='va'>fstats.Matrix</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Leonardo Collado-Torres, Andrew E. Jaffe, Jeffrey T. Leek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


